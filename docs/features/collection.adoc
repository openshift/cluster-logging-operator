== Collection and Log Forwarding Features

Administrators create a `ClusterLogForwarder` instance to specify which logs will be collected, how they will be transformed, and to where they will be forwarded.  The operator will deploy a collector based upon this specification.  There are two collector options supported by this operator: https://www.fluentd.org/[fluentd] and https://vector.dev/[vector].  Vector is the newest collector implementation and the difference in feature parity is identified below.

NOTE: Some features implemented in fluentd may not be implemented for vector.  Justifications for this variance will be documented below.

=== Log Sources
Following is a list of possible log sources that are collected from each node in the cluster:

.Log Sources
[options="header"]
|======
|Feature|Desc.|Fluentd|Vector
|App container logs|Logs generated by container workloads in non-infrastructure namespaces|✓|✓
|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/forwarder-label-selector.md[Application label selector]|Selectively collect application by namespace or pod label selector|✓|✓
|Infra container logs|Logs generated by container workloads in infrastructure namespaces|✓|✓
|Infra journal logs|Logs generated by node services from the nodes' journald service|✓|✓
|Kubernetes api audit logs|Kubernetes api service logs|✓|✓
|OpenShift api audit logs|OpenShift api service logs|✓|✓
|OVN audit logs|Open Virtual Network Logs written to the node filesystem|✓|✓
|Auditd logs|Linux auditd logs written to the node filesystem|✓|✓
|======

=== Outputs

.Output Destinations
[options="header"]
|======
|Feature|Protocol|Tested with|Fluentd|Vector
|Cloudwatch|REST over HTTPS||✓|✓
|Elasticsearch||||
| * v6||v6.8.1|✓|✓
| * v7||v7.12.2|✓|✓
| * v8||||✓
|Google Cloud Logging||||✓

|Kafka|kafka 0.11|kafka 2.4.1 kafka 2.7.0|✓|✓

|Fluent Forward|fluentd forward v1|fluentd 1.14.6
logstash 7.10.1|✓|

|Loki|REST over HTTP(S)|Loki 2.3.0|✓|✓
|Splunk|HEC|v9.0.0||✓
|Syslog|RFC3164,RFC5424|rsyslog 8.39.0|✓|
|Http|Http 1.1|vector 0.28-1, fluentd 1.14.6||✓
|======

=== Authorization and Authentication

.Authorization and Authentication Methods
[options="header"]
|======
|Feature|Output Type|Fluentd|Vector
|Token|loki, splunk, http||
|Certificates|elasticsearch, kafka, fluentd forward, splunk, http|✓|✓
|Cloud service keys|cloudwatch|✓|✓
|Cloud service keys| google||✓
|Username / Password|elasticsearch, kafka, http||
|Security Token Service (STS)|cloudwatch|✓|✓
|SASL|kafka|✓|✓
|======

=== Normalizations and Transformations
.Normalizations and Transformations
[options="header"]
|======
|Feature|Desc.|Fluentd|Vector
|Viaq data model|See reference document for details.  Not all fields are supported for both collector implementations |✓|✓
|Loglevel||✓|✓
|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/forwarding-json-structured-logs.md[JSON Parsing]||✓|✓
|Structured Index for Elasticsearch JSON parsing||✓|✓
|https://github.com/openshift/cluster-logging-operator/blob/master/docs/features/logforwarding/multiline-error-detection.adoc[Multiline error detection]|See feature document for languages supported by each collector|✓|✓
|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/multi-container-structured-logging.md[Split indices for multi-container pods]||✓|✓
|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/forwarder-tagging.md[Static labels for forwarding pipelines] ||✓|✓

|======

=== Security and Compliance
.Security and Compliance
[options="header"]
|======
|Feature|Desc.|Fluentd|Vector
|FIPS|Tested on a FIPS enabled cluster|✓|✓
|Crypto Export||?|?

|https://issues.redhat.com/browse/LOG-3270[TLS Security Profile Compliance]
|Comply with OCP cluster-wide cryptographic profiles for internal communication and allow configuration of outbound connection profiles. See link:./tls_security_profile.adoc[details]
|n/a|✓
|======

=== Tuning
.Fluentd Tuning
[options="header"]
|======
|Feature|Desc.
|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/fluentd-tuning.md[Source]
| readLinesLimit

|https://github.com/openshift/enhancements/blob/196445c9d19b2159c9e8639e4428fa5a4c1b3577/enhancements/cluster-logging/fluentd-tuning.md[Output Buffering]
|
- chunklimitsize
- totallimitsize
- overflowaction
- flushthreadcount
- flushmode
- flushinterval
- retrywait
- retrytype
- retrymaxinterval
- retrytimeout

|======

=== Metrics and Alerting
.Metrics and Alerting
[options="header"]
|======
|Feature|Desc.|Fluentd|Vector
|Logs collected||✓|
|Container logs generated||✓|✓
|Collector dashboard||✓|✓
|Collector alerts||✓|

|======

=== Miscellaneous
.Miscellaneous
[options="header"]
|======
|Feature|Desc.|Fluentd|Vector
|Global Proxy||✓|✓
|Architecture|||
| ...x86||✓|✓
| ...ARM||✓|✓
| ...Power PC||✓|✓
| ...IBM Z||✓|✓
| IPv6||✓|✓

|======
