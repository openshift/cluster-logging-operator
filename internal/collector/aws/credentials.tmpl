{{range . -}}
{{if .AssumeRole -}}

# Source profile for initial web identity authentication
[output_{{ .Name }}_source]
web_identity_token_file={{ .WebIdentityTokenFile }}
role_arn={{ .RoleARN }}
role_session_name=output-{{ .Name }}-source

# Assume role profile for cross-account access
[output_{{ .Name }}]
source_profile=output_{{ .Name }}_source
role_arn={{ .AssumeRole }}
{{- if .ExternalID }}
external_id={{ .ExternalID }}
{{- end }}
{{- if .SessionName }}
role_session_name={{ .SessionName }}
{{- else }}
role_session_name=output-{{ .Name }}
{{- end }}
{{else -}}

# Direct authentication profile
[output_{{ .Name }}]
web_identity_token_file={{ .WebIdentityTokenFile }}
role_arn={{ .RoleARN }}
role_session_name=output-{{ .Name }}
{{end}}
{{- end}}