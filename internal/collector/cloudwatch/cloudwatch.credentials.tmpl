{{range . -}}
{{if .AssumeRoleARN -}}
# Base profile for initial authentication
[output_{{ .Name }}_base]
web_identity_token_file={{ .WebIdentityTokenFile }}
role_arn={{ .RoleARN }}
role_session_name=output-{{ .Name }}-base

# Assume role profile for cross-account access
[output_{{ .Name }}]
source_profile=output_{{ .Name }}_base
role_arn={{ .AssumeRoleARN }}
{{- if .ExternalID }}
external_id={{ .ExternalID }}
{{- end }}
{{- if .SessionName }}
role_session_name={{ .SessionName }}
{{- else }}
role_session_name=output-{{ .Name }}
{{- end }}
{{else -}}
# Direct authentication profile
[output_{{ .Name }}]
web_identity_token_file={{ .WebIdentityTokenFile }}
role_arn={{ .RoleARN }}
role_session_name=output-{{ .Name }}
{{end}}
{{- end}}