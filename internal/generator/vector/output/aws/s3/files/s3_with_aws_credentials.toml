[transforms.s3_key_prefix]
type = "remap"
inputs = ["s3-forward"]
source = '''
  ._internal.s3_key_prefix = "app-" + to_string!(._internal.log_type||"missing")
'''

[sinks.s3]
type = "aws_s3"
inputs = ["s3_key_prefix"]
region = "us-east-test"
bucket = "my-test-bucket"
key_prefix = "{{ _internal.s3_key_prefix }}"

[sinks.s3.encoding]
codec = "json"
except_fields = ["_internal"]

[sinks.s3.auth]
credentials_file = "/var/run/ocp-collector/config/my-forwarder-aws-creds/credentials"
profile = "output_s3"

[sinks.s3.healthcheck]
enabled = false